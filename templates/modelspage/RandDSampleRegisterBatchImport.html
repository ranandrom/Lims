{% extends 'base.html' %}

{% block content %}
        <!-- top tiles -->
        <div class="">
            <div class="page-title">
              <div class="title_left">
                <h2>样本登记 <small>（研发）</small></h2>
                 <form enctype="multipart/form-data" id="demo-form2" data-parsley-validate class="form-horizontal form-label-left" method="post" action="/RandDSampleInfoInputData/">
                     <input type="file" name="myfile" />
                     <div id="DivfileName" style="width: 100%; display: none" >
                        <h2>已导入文件：{{ fileName }}</h2>
                    </div>
                     <input type="text" id="fileName" name="fileName"  style="display: none" value = "{{ fileName }}" readonly>
                    <script type="text/javascript">
                        var val = document.getElementById("fileName").value;
                        //alert(val);
                        if(val != ""){
                            document.getElementById("DivfileName").style.display="";
                        }
                    </script>
                     <button type="submit" class="btn btn-primary" name="upload">确认导入</button>
                  </form>
              </div>
            </div>
            <div class="clearfix"></div>

            <div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_content">
                     <form id="demo-form2" data-parsley-validate class="form-horizontal form-label-left" method="post" action="/RandDSampleInfoInputToDataBase/">

                      <table id="datatable_responsive" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                          <datalist id="sheet_namelistID">
                              {%  for name in sheet_name %}
                                    <option>{{ name }}</option>
                              {% endfor %}
                          </datalist>
                          <thead>
                            <tr>
                                <th style="text-align:center;">
                                  <p>样本编号</p>
                                  <p>第
                                      <input type="text" style="width: 75%" id="sheet_sam_code_num" name="sheet_sam_code_num" list="sheet_namelistID"
                                             onChange=setClosVal("num_sam_code_num_colslistID","sheet_sam_code_num") >
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_sam_code_num" name="clos_sam_code_num" list="num_sam_code_num_colslistID">
                                      列</p>
                                      <datalist id="num_sam_code_num_colslistID"></datalist>
                                      <p><input name="button_sam_code_num" type="button"  value="确认导入" onclick=setVal("sheet_sam_code_num","sam_code_num","clos_sam_code_num")>
                                  </p>
                                </th>
                               <th style="text-align:center;">
                                <p>送检医院</p>
                                  <p>第
                                      <input type="text" style="width: 75%" id="sheet_HospitalForInspection" name="sheet_HospitalForInspection" list="sheet_namelistID"
                                             onChange=setClosVal("num_HospitalForInspection_colslistID","sheet_HospitalForInspection")>
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="num_HospitalForInspection_colslistID">
                                      列</p>
                                      <datalist id="num_HospitalForInspection_colslistID"></datalist>
                                      <p><input name="button_HospitalForInspection" type="button"  value="导入" onclick=setVal("sheet_HospitalForInspection","HospitalForInspection","clos_HospitalForInspection")>
                                  </p>
                                </th>
                              <th style="text-align:center;">
                                <p>联系人</p>
                                <p>第
                                      <input type="text" style="width: 75%" id="sheet_Contacts" name="sheet_Contacts" list="sheet_namelistID"
                                             onChange=setClosVal("num_Contacts_colslistID","sheet_Contacts")>
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_Contacts" name="clos_Contacts" list="num_Contacts_colslistID">
                                      列</p>
                                      <datalist id="num_Contacts_colslistID"></datalist>
                                      <p><input name="button_HospitalForInspection" type="button"  value="导入" onclick=setVal("sheet_Contacts","Contacts","clos_Contacts")>
                                  </p>
                              </th>
                              <th style="text-align:center;">
                                <p>收样时间（血样）</p>
                                <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="sheet_namelistID">
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="num_colslistID">
                                      列</p>
                                      <p><input name="button_HospitalForInspection" type="button"  value="导入" onclick=setVal("HospitalForInspection","clos_HospitalForInspection")>
                                  </p>
                              </th>
                              <th style="text-align:center;">
                                <p>收样时间（组织）</p>
                                <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="sheet_namelistID">
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="num_colslistID">
                                      列</p>
                                      <p><input name="button_HospitalForInspection" type="button"  value="导入" onclick=setVal("HospitalForInspection","clos_HospitalForInspection")>
                                  </p>
                              </th>
                              <th style="text-align:center;">
                                <p>收样人</p>
                                <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="sheet_namelistID">
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="num_colslistID">
                                      列</p>
                                      <p><input name="button_HospitalForInspection" type="button"  value="导入" onclick=setVal("HospitalForInspection","clos_HospitalForInspection")>
                                  </p>
                              </th>
                              <th style="text-align:center;">
                                <p>住院号</p>
                                <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="sheet_namelistID">
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="num_colslistID">
                                      列</p>
                                      <p><input name="button_HospitalForInspection" type="button"  value="导入" onclick=setVal("HospitalForInspection","clos_HospitalForInspection")>
                                  </p>
                              </th>
                              <th style="text-align:center;">
                                <p>病理号</p>
                                <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="sheet_namelistID">
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="num_colslistID">
                                      列</p>
                                      <p><input name="button_HospitalForInspection" type="button"  value="导入" onclick=setVal("HospitalForInspection","clos_HospitalForInspection")>
                                  </p>
                              </th>
                              <th style="text-align:center;">
                                <p>相关编号</p>
                                <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="sheet_namelistID">
                                      页</p>
                                      <p>第
                                      <input type="text" style="width: 75%" id="clos_HospitalForInspection" name="clos_HospitalForInspection" list="num_colslistID">
                                      列</p>
                                      <p><input name="button_HospitalForInspection" type="button"  value="导入" onclick=setVal("HospitalForInspection","clos_HospitalForInspection")>
                                  </p>
                              </th>
                            </tr>
                          </thead>

                           <tbody id="tbody_review">
                                <tr>
                                    <td><textarea name="sam_code_num" id="sam_code_num" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="样本编号" required></textarea></td>
                                    <td><textarea id="HospitalForInspection" name="HospitalForInspection" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="送检医院"></textarea></td>
                                    <td><textarea id="Contacts" name="Contacts" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="联系人"></textarea></td>
                                    <td><textarea id="SamplingTime_Blood" name="SamplingTime_Blood" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="收样时间（血样）"></textarea></td>
                                    <td><textarea id="SamplingTime_Tissue" name="SamplingTime_Tissue" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="收样时间（组织）"></textarea></td>
                                    <td><textarea id="Collector" name="Collector" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="收样人"></textarea></td>
                                    <td><textarea id="InpatientNumber" name="InpatientNumber" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="住院号"></textarea></td>
                                    <td><textarea id="PathologicalNumber" name="PathologicalNumber" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="病理号"></textarea></td>
                                    <td><textarea id="CorrelationNumber" name="CorrelationNumber" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="相关编号"></textarea></td>
                                </tr>
                          </tbody>
                        </table>
                        <script type="text/javascript">
                          var dictData = {{ dictData | safe }};
                          var dictClos = {{ dictClos | safe }};
                          //document.getElementById("SamplingTime_Blood").value = SamplingTime[0] ;
                          //for (var key in dict) {
                              //console.log(key + ":" + dict[key]);
                              //alert(key);
                              //alert(dict[key]);
                         // }
                          function setClosVal(datalistID,sheetName) {
                              var sheet = document.getElementById(sheetName).value;
                              for (var key in dictClos) {
                                  if(key == sheet){
                                      //document.getElementById(inputID).value =  dictClos[key];
                                      //获取datalist的dom
                                      var ss = document.getElementById(datalistID);
                                      for (var i = 0; i < dictClos[key].length; i++) {
                                          //var city = cities[i];
                                          //纯js实现的方式
                                          var op = document.createElement("option");
                                          //op.setAttribute("label", city.label);
                                          op.setAttribute("value", dictClos[key][i]);
                                          ss.appendChild(op);
                                      }
                                  }
                              }
                          }
                          function setVal(sheetName,inputID,closID){
                              var clos = document.getElementById(closID).value;
                              var sheet = document.getElementById(sheetName).value;
                              //document.getElementById(inputID).value = SamplingTime[clos-1];
                              //alert(sheetName);
                              //document.getElementById(inputID).value =  dict[sheetName][clos-1];
                              //alert(dict[sheetName][clos-1]);
                              for (var key in dictData) {
                                  if(key == sheet){
                                    document.getElementById(inputID).value =  dictData[key][clos-1];
                                  }
                              }
                          }
                      </script>

                      <table id="datatable_responsive" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                        <thead>
                        <tr>
                          <th>患者姓名</th>
                          <th>患者年龄（岁）</th>
                          <th>患者性别</th>
                          <th>血样类型</th>
                          <th>采血时间</th>
                          <th>组织样本来源</th>
                          <th>组织数量</th>
                          <th>组织类型</th>
                          <th>组织样本处理方式</th>
                        </tr>
                      </thead>

                       <tbody id="tbody_review">
                            <tr>
                                <td><textarea name="PatientName" id="PatientName" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="患者姓名"></textarea></td>
                                <td><textarea id="PatientAge" name="PatientAge" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="患者年龄（岁）"></textarea></td>
                                <td><textarea id="PatientSex" name="PatientSex" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="患者性别"></textarea></td>
                                <td><textarea id="BloodSampleType" name="BloodSampleType" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="血样类型"></textarea></td>
                                <td><textarea id="BloodSamplingTime" name="BloodSamplingTime" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="采血时间"></textarea></td>
                                <td><textarea id="TissueSampleSources" name="TissueSampleSources" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="组织样本来源"></textarea></td>
                                <td><textarea id="TissueQuantity" name="TissueQuantity" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="组织数量"></textarea></td>
                                <td><textarea id="TissueType" name="TissueType" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="组织类型"></textarea></td>
                                <td><textarea id="TissueSampleProcessing" name="TissueSampleProcessing" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="组织样本处理方式"></textarea></td>
                            </tr>
                      </tbody>
                    </table>

                      <table id="datatable_responsive" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                        <thead>
                        <tr>
                          <th>手术日期</th>
                          <th>病理信息</th>
                          <th>TNM分期</th>
                          <th>Stage</th>
                          <th>分子诊断信息</th>
                          <th>分类</th>
                          <th>血浆用途</th>
                          <th>组织用途</th>
                          <th>血浆存放位置</th>
                          <th>组织存放位置</th>
                        </tr>
                      </thead>

                       <tbody id="tbody_review">
                            <tr>
                                <td><textarea id="OperationDate" name="OperationDate" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="手术日期"></textarea></td>
                                <td><textarea id="PathologicalInfo" name="PathologicalInfo" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="病理信息"></textarea></td>
                                <td><textarea id="TNMStaging" name="TNMStaging" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="TNM分期"></textarea></td>
                                <td><textarea id="Stage" name="Stage" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="Stage"></textarea></td>
                                <td><textarea id="MolecularDiagnosticInfo" name="MolecularDiagnosticInfo" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="分子诊断信息"></textarea></td>
                                <td><textarea id="Classification" name="Classification" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="分类"></textarea></td>
                                <td><textarea id="PlasmaUse" name="PlasmaUse" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="血浆用途"></textarea></td>
                                <td><textarea id="TissueUse" name="TissueUse" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="组织用途"></textarea></td>
                                <td><textarea id="PlasmaStoragePosition" name="PlasmaStoragePosition" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="血浆存放位置"></textarea></td>
                                <td><textarea id="TissueStoragePosition" name="TissueStoragePosition" class="form-control col-md-7 col-xs-12" type="text" rows="10" placeholder="组织存放位置"></textarea></td>
                            </tr>

                      </tbody>
                     </table>

                     <div class="ln_solid"></div>
                      <div class="form-group">
                            <label >*样本审核人</label>
                                <select id="SampleAuditor" name="SampleAuditor" class="btn btn-default" required>
                                    {%  for data in userlist %}
                                        <option value="{{ data.username }}">{{ data.username }}</option>
                                    {% endfor %}
                                </select>

                       </div>

                     <div class="ln_solid"></div>
                      <div class="form-group">
                          <a href="/RandDSampleInfoInputHomePage/"><button class="btn btn-primary" type="button" >返回</button></a>
                          <button type="submit" class="btn btn-success" name="batchAddSampleDraft">存为草稿</button>
                          <button class="btn btn-success" type="submit" name="batchAddSample">提交审核</button>
                      </div>

                    </form>

                  </div>
                </div>
              </div>
            </div>

        </div>


 {% endblock %}